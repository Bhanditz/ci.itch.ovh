
- job:
    name: itchio-app
    project-type: matrix
    node: gcs
    execution-strategy:
      combination-filter: (JENKINS_OS == "darwin").implies(JENKINS_ARCH == "amd64")
    parameters:
      - string:
          name: JENKINS_TAG
    axes:
      - axis:
          type: label-expression
          name: JENKINS_OS
          values:
            - windows
            - darwin
            - linux
      - axis:
          type: user-defined
          name: JENKINS_ARCH
          values:
            - 386
            - amd64
    workspace: 'workspace/itchio-app/$JENKINS_OS-$JENKINS_ARCH'
    child-workspace: .
    wrappers:
      - ansi-color
    scm:
      - .git: &itchio-app-git
          host: github.com
          user: itchio
          name: itchio-app
          branches: '$JENKINS_TAG'
          wipe: false
    builders:
      - shell: |
          node --version
          npm --version
      - shell: |
          npm config set spin false
          npm install grunt-cli
          export PATH=$PATH:$PWD/node_modules/.bin
          npm install
          grunt all
          npm test

- job:
    name: itchio-app-trigger
    node: groovy
    scm:
      .git:
        <<: *itchio-app-git
        branches: '**'
        wipe: false
    token: 'GATA_LOCA_BAILA_RUMBA'
    wrappers:
      - ansi-color
    builders:
      - groovy:
          command:
            .export-latest-tag:
    publishers:
      - trigger-parameterized-builds:
        - project: itchio-app
          property-file: revision.properties
          condition: success
