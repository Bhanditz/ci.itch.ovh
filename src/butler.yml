
- .go-job:
    # always triggered by `butler-releases`
    name: butler
    pkg: './cmd/butler'
    exe: 'butler'
    git: &butler-git
      host: github.com
      user: itchio
      name: butler
      branches: '$JENKINS_TAG'
      wipe: true

- job:
    # triggered by POST to /job/butler-releases/build?token=XXX
    # checks if there's a recent tag we haven't built, in which case,
    # asks `butler` to build that. If there isn't, asks `butler` to build
    # whatever ('**') which means any commit pushed to any branch
    name: butler-trigger
    node: groovy
    scm:
      .git:
        <<: *butler-git
        branches: '**'
        wipe: false
    token: 'JOLLY_FARM'
    builders:
      - groovy:
          command:
            .export-latest-tag:
    publishers:
      - trigger-parameterized-builds:
        - project: butler
          property-file: revision.properties
          condition: success
