
- job:
    name: itch
    project-type: matrix
    node: gcs
    execution-strategy:
      combination-filter: (JENKINS_OS == "darwin").implies(JENKINS_ARCH == "amd64")
    parameters:
      - string:
          name: JENKINS_TAG
          default: '**'
      - string:
          name: JENKINS_DEPLOY
          default: 0
    .osarch-axes:
      os: ['windows', 'darwin', 'linux']
      arch: ['386', 'amd64']
    wrappers:
      - inject
      - ansi-color
    scm:
      - .git: &itch-git
          host: github.com
          repo: itchio/itch
          branches: '$JENKINS_TAG'
    builders:
      - shell: |
          node --version
          npm --version
      - shell: |
          npm config set spin false
          npm install -g grunt-cli
          export PATH=$PATH:$PWD/node_modules/.bin
          npm install
          grunt all
          npm test

- .tag-trigger:
    project: itch
    git: *itch-git

- .commit-trigger:
    project: itch
    git: *itch-git
