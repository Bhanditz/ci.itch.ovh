
- job:
    name: wharf
    scm:
      .git-go: &wharf-git
        host: bitbucket.org
        repo: itchio/wharf
        branches: '$JENKINS_TAG'
    parameters:
      - ..base-parameters:
    wrappers:
      - ..base-wrappers:
      - workspace-cleanup:
          delete-dirs: true
    builders:
      - shell: |
          export GOPATH="$WORKSPACE"
          JENKINS_IMPORT_PATH=bitbucket.org/itchio/wharf

          go get -d -v $JENKINS_IMPORT_PATH/...
          go build -v $JENKINS_IMPORT_PATH
          file wharf

          if [ "$JENKINS_DEPLOY" = "1" ]; then
            7za a wharf.7z $TARGET
            echo $JENKINS_VERSION > LATEST
          fi
    publishers:
      - .deploy-to-gcs:
          package: wharf

- ..standard-triggers:
    project: wharf
    git: *wharf-git
