
- :on-os-arch:
    conditional-step:
      condition-kind: regex-match
      label: $os-$arch
      regex: '{spec string}'
      steps: '{do list}'

- :on-deploy:
    - condition-kind: regex-match
      label: '$JENKINS_TAG'
      regex: '^v.*$'
      action: '{*}'

- :on-windows:
    .on-os-arch:
      spec: windows-.*
      do: '{* list}'

- :on-unix:
    .on-os-arch:
      spec: (linux|darwin)-.*
      do: '{* list}'

- :export:
    inject:
      properties-content: '{* string}'

- :git-advanced:
    git:
      url: 'git@{host}:{user}/{name}.git'
      credentials-id: 'f5387502-f743-45da-b8d7-1a8bf7d2a54e'
      branches:
        - '{branches}'
      relative-target-dir: '{dir}'

- :git:
    .git-advanced:
      host: '{host}'
      user: '{user}'
      name: '{name}'
      branches: '{branches}'
      dir: '.'

# checks out in a subdirectory suitable for `go get`
- :git-go:
    .git-advanced:
      host: '{host}'
      user: '{user}'
      name: '{name}'
      branches: '{branches}'
      dir: 'src/{host}/{user}/{name}'

- :deploy-to-gcs:
    conditional-publisher:
      - condition-kind: regex-match
        label: $JENKINS_DEPLOY
        regex: 1
        action:
          - google-cloud-storage:
              credentials-id: butler-server-1131
              uploads:
                - classic:
                    storage-location: 'gs://dl.itch.ovh/{package}/$JENKINS_OS-$JENKINS_ARCH/$JENKINS_VERSION'
                    file-pattern: '{package}.7z'
                    share-publicly: true
                - classic:
                    storage-location: 'gs://dl.itch.ovh/{package}/$JENKINS_OS-$JENKINS_ARCH'
                    file-pattern: 'LATEST'
                    share-publicly: true
